<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>春日部硬式テニスクラブ｜春日部 テニス サークル・メンバー募集中</title>

  <!-- 外部CSS読み込み（下に示す styles-flex.css を用意） -->
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="image/kasukoumarkG.jpg">
  <meta property="og:site_name" content="春日部硬式テニスクラブ" />
  <meta property="og:title" content="春日部硬式テニスクラブ" />
  <meta property="og:description" content="春日部市で活動する硬式テニスサークルです。初心者〜上級者歓迎、メンバー随時募集中。活動日・コート案内はこちら" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://kasukou2025.stars.ne.jp" />
  <meta property="og:image" content="https://kasukou2025.stars.ne.jp/image/kasukoumarkG.jpg" />

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "春日部硬式テニスクラブ v2",
      "url": "https://kasukou2025.stars.ne.jp"
    }
    </script>

</head>

<body>
  <div class="container">
    <!-- ヘッダー全体を包む -->
    <header class="site-header">
      <!-- 背景の鳥や木の絵がある場合は、CSSで背景画像を敷いています -->
      <div class="header-inner">
        <!-- タイトル部分 -->
        <div class="title-bk">
          <img src="image/geo/title-bk.jpg" alt="" class="title-bk-image" />
        </div>
        <div class="title">
          <div class="title-big">春日部硬式テニスクラブ</div>
          <span class="title-small">のホームページへようこそ！</span>
        </div>
        <!-- <p class="author">by K.Kazami</p> -->
      </div>

      <!-- 棒の画像 -->
    </header>
    <header class="site-header-mobile">
      <div>
        <div class="title-big">春日部硬式テニスクラブ</div>
      </div>
    </header>
    <!-- メイン領域（左右でFlex） -->
    <div class="main-container">

      <!-- ハンバーガーメニューのチェックボックス -->
      <input type="checkbox" id="menu-toggle" class="menu-checkbox">
      <label for="menu-toggle" class="menu-icon">☰</label>

      <!-- 左メニュー -->
      <nav class="left-menu">
        <div class="list-wrap">
          <h2>リンク</h2>
          <ul>
            <li>
              <a href="introduction/introduction2024.html">クラブ紹介</a>
            </li>
            <li>
              <a href="coatbokking/NEWFORMAT/2025/coatbooking04-onuma.html">コート予約状況</a>
            </li>
            <li><a href="./gyouji-SS.html">行事予定表</a></li>
            <li><a href="http://kasukabekoshiki.bbs.fc2.com/">何でも伝言板</a>
            </li>
            <li><a href="http://www.k-t-a.org">春日部市テニス協会</a></li>
            <li><a href="https://sta-tennis.org/">埼玉県テニス協会</a></li>

            <li><a href="http://glofo835.g2.xrea.com/">日本女子テニス連盟 <br>埼玉県支部</a></li>
          </ul>
        </div>
        <div class="list-wrap">
          <h2>ダウンロード</h2>
          <ul>
            <li><a href="kiyaku20250518.pdf">クラブ規約</a></li>
            <li><a href="nyuukaitodoke20250618.pdf">入部届け</a></li>
            <li><a href="seiyakusho2021.pdf">ジュニア誓約書</a></li>
            <li><a href="kyuubutodoke202503.pdf">休退復部届け</a></li>
            <li>
              <a href="2015_questionnaire.pdf">クラブ運営のアンケート結果</a>
            </li>
            <li><a href="tennis_manner.pdf">クラブ細部マナー事項</a></li>
          </ul>
        </div>
      </nav>

      <!-- 右のメイン表示部分 -->
      <main class="main-content">
        <!-- テニスボール画像や「会員募集中」など -->
        <div class="pinned-area">
          <p class="recruit">
          <div class="highlight-red">会員募集中！</div>
          <span class="small-note">入会希望の方は、kubochan2010@jcom.zaq.ne.jp<br>もしくは、<a
              href="http://kasukabekoshiki.bbs.fc2.com/">何でも伝言板</a>からお問い合わせ下さい</span>
          </p>
          <!-- <div class="rod-wrap">
		<img src="image/geo/top.jpg" alt="棒の画像" class="rod-img">
	  </div> -->
          <div class="tennis-ball-container">
            <div class="tennis-ball-wrap">
              <img src="image/kasukoumarkG.jpg" alt="テニスボールマーク" class="tennis-ball" />
            </div>
          </div>
        </div>


        <!-- 本日のコート予約状況（自動取得表示） -->
        <div id="today-booking" class="today-booking">
          <!-- JS が本日分の予約をここに差し込みます -->
        </div>

        <!-- 下部の説明など -->
        <div class="explain-area">
          <p class="search-note">検索は　「春日部硬式」　で！</p>
          <p class="small-text">
            ※ボランティアで開設しているホームページです。<br />
            不行き届きな点が多々ありますがご了承ください。
          </p>
        </div>
      </main>
    </div>
    <!-- .main-container -->
  </div>

  <!-- コート予約リンクの動的変更スクリプトを追加 -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // --- 既存: 月別リンクを当月に差し替え ---
      // 正常な今日の日付を使う
      const date = new Date();
      // テストで固定日付にしたい場合は下のようにコメントを外して使えます:
      // const date = new Date('2025-12-25T00:00:00'); // テスト用固定日付
      const year = date.getFullYear();
      const monthNum = date.getMonth() + 1;
      const month2 = ('0' + monthNum).slice(-2); // 2桁にフォーマット

      const bookingLink = `coatbokking/NEWFORMAT/${year}/coatbooking${month2}-onuma.html`;
      const anchor = document.querySelector('a[href^="coatbokking/NEWFORMAT/"]');
      if (anchor) {
        anchor.setAttribute('href', bookingLink);
      }

      // --- 新規: 本日のコート予約状況を月別ページから取得して表示 ---
      const todayDiv = document.getElementById('today-booking');
      if (!todayDiv) return;

      const locations = [
        { key: 'onuma', label: '大沼' },
        { key: 'tatenuma', label: '立沼' }
      ];

      function bookingPath(locKey) {
        return `coatbokking/NEWFORMAT/${year}/coatbooking${month2}-${locKey}.html`;
      }

      async function fetchAndParse(loc) {
        try {
          const resp = await fetch(bookingPath(loc.key));
          if (!resp.ok) throw new Error('fetch failed');
          const text = await resp.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(text, 'text/html');
          const table = doc.querySelector('table.auto-style27');
          if (!table) return { found: false };

          const month = date.getMonth() + 1;
          // const month = 12;
          const day = date.getDate();
          // const day = 5;
          const dateRe = new RegExp(month + '月\\s*' + day + '日');
            
          const trs = Array.from(table.querySelectorAll('tr'));
          for (let i = 0; i < trs.length; i++) {
            const tds = trs[i].querySelectorAll('td');
            if (!tds || tds.length === 0) continue;
            for (let j = 0; j < tds.length; j++) {
              if (dateRe.test(tds[j].textContent)) {
                const trA = trs[i];
                const trB = trs[i + 1];
                const tdsA = trA.querySelectorAll('td');
                const tdsB = trB ? trB.querySelectorAll('td') : [];

                const courtA = (tdsA[2] && tdsA[2].textContent.trim()) || 'A';
                const timesA = Array.from(tdsA).slice(3, 7).map(td => td ? td.textContent.trim() : '');

                const courtB = (tdsB[0] && tdsB[0].textContent.trim()) || 'B';
                const timesB = Array.from(tdsB).slice(1, 5).map(td => td ? td.textContent.trim() : '');

                return { found: true, courtA, timesA, courtB, timesB };
              }
            }
          }
          return { found: false };
        } catch (e) {
          return { error: true };
        }
      }

      // コート予約状況テーブルを作成 
      function makeTableForResult(res) {
        const tbl = document.createElement('table');
        tbl.className = 'booking-table';
        const header = document.createElement('tr');
        ['コート', '9-11', '11-13', '13-15', '15-17'].forEach(h => {
          const th = document.createElement('th');
          th.textContent = h;
          header.appendChild(th);
        });
        tbl.appendChild(header);

        const trA = document.createElement('tr');
        const tdCourtA = document.createElement('td');
        tdCourtA.textContent = res.courtA;
        trA.appendChild(tdCourtA);
        res.timesA.forEach(t => {
          const td = document.createElement('td');
          td.textContent = t;
          trA.appendChild(td);
        });
        tbl.appendChild(trA);

        const trB = document.createElement('tr');
        const tdCourtB = document.createElement('td');
        tdCourtB.textContent = res.courtB;
        trB.appendChild(tdCourtB);
        res.timesB.forEach(t => {
          const td = document.createElement('td');
          td.textContent = t;
          trB.appendChild(td);
        });
        tbl.appendChild(trB);
        return tbl;
      }

      async function render() {
        // 今日の日付を「YYYY年M月D日（曜日）」フォーマットで表示
        const days = ['日', '月', '火', '水', '木', '金', '土'];
        const dayOfWeek = days[date.getDay()];
        const dateStr = `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日（${dayOfWeek}）`;
        
        todayDiv.innerHTML = `<h3>本日（${dateStr}）のコート予約状況</h3><div id="booking-list">読み込み中…</div>`;
        const list = document.getElementById('booking-list');
        const results = await Promise.all(locations.map(l => fetchAndParse(l)));
        list.innerHTML = '';
        locations.forEach((loc, idx) => {
          const res = results[idx];
          const wrap = document.createElement('div');
          wrap.className = 'booking-location';
          const title = document.createElement('strong');
          title.className = 'booking-location-title';
          title.textContent = loc.label;
          wrap.appendChild(title);
          if (res && res.found) {
            wrap.appendChild(makeTableForResult(res));
          } else {
            const p = document.createElement('p');
            p.className = 'booking-no-data';
            if (res && res.error) {
              p.textContent = '読み込みに失敗しました。';
            } else {
              p.textContent = '本日は予約なしです。';
            }
            const a = document.createElement('a');
            a.href = bookingPath(loc.key);
            a.textContent = ' 月別ページ';
            p.appendChild(a);
            wrap.appendChild(p);
          }
          list.appendChild(wrap);
        });
      }

      render();
    });
  </script>
</body>

</html>